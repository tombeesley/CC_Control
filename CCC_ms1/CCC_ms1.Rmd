---
title             : "Contextual cuing in the presence of an overt instruction"
shorttitle        : "Contextual cuing and instruction"
author: 
  - name          : "Tom Beesley"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Department of Psychology, Lancaster University, UK, LA1 4YD"
    email         : "t.beesley@lancaster.ac.uk"
  - name          : "David Luque" 
    affiliation   : "2"
affiliation:
  - id            : "1"
    institution   : "Lancaster University, UK"
  - id            : "2"
    institution   : "Universidad Autónoma de Madrid, Spain"
abstract: |
  abstract here
  
  
  
  Public significance statement: 
keywords          : "keywords"
wordcount         : "X"
bibliography      : ["references.bib"]
figsintext        : yes
floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no
header-includes:
  - \raggedbottom
  - \usepackage[font={small,it}, labelfont={bf}]{caption}
csl               : "apa7.csl"
documentclass     : "apa7"
classoption       : "man"
output            : papaja::apa6_pdf
editor_options: 
  chunk_output_type: console
---

```{r knitr-options}
knitr::opts_chunk$set(warning=FALSE, 
                      message=FALSE, 
                      include=FALSE,
                      dev = "cairo_pdf")
```

```{r rmd-setup, include = FALSE}
library(tidyverse)
library(citr)
library(papaja)
library(english)
library(extrafont)
library(afex) 
library(BayesFactor)
library(apa)
library(pwr) # power calculations
library(lsr) # effect size estimate
# library(skimr)
# library(rstudioapi)
# library(kableExtra)

# function used to set rounding and presentation of decimals to specific length
spec_dec <- function(x, k) trimws(format(round(x, k), nsmall=k)) # useful for controlling decimals

# function to force scientific formatting of numbers (used for large BFs)
changeSciNot <- function(n) {
  output <- format(n, scientific = TRUE, digits = 2) #Transforms the number into scientific notation even if small
  output <- sub("e", "x10^", output) #Replace e with 10^
  output <- sub("\\+0?", "", output) #Remove + symbol and leading zeros on expoent, if > 1
  output <- sub("-0?", "-", output) #Leaves - symbol but removes leading zeros on expoent, if < 1
  output
}

# setwd(dirname(rstudioapi::getActiveDocumentContext()$path)) # set wd to current file location

theme_set(theme_classic(base_size = 12))
#theme_update(panel.background = element_rect(fill = "grey80"))
cbPalette <- c("#C1272D", "#E69F00", "#56B4E9", "#008176", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
#r_refs("references.bib")

```

Main text here [@beesley2015b]

```{r exploratory_anaysis}

data_raw <- readRDS("combinedData.rds")

# get summary stats 

# how many participants in each experiment
data_raw %>%
  group_by(exp) %>% 
  summarise(num_Ps = n_distinct(subj))

# mean RT by participant
summary_rt <- 
  data_raw %>% 
  filter(timeout == 0,
         acc == 1) %>% 
  group_by(exp, subj) %>% 
  summarise(meanRT = mean(RT))

# plot as violin
summary_rt %>% 
  ggplot(aes(x = exp, y = meanRT)) +
  geom_violin(aes(fill = exp)) +
  geom_dotplot(binaxis = "y",
               stackdir = "center",
               dotsize = 2,
               binwidth = 25,
               alpha = .3)

# mean acc by participant
summary_acc <- 
  data_raw %>% 
  filter(timeout == 0) %>% 
  group_by(exp, subj) %>% 
  summarise(meanAcc = mean(acc))

# plot as violin
summary_acc %>% 
  ggplot(aes(x = exp, y = meanAcc)) +
  geom_violin(aes(fill = exp)) +
  geom_dotplot(binaxis = "y",
               stackdir = "center",
               binwidth = .01,
               dotsize = 1,
               alpha = .3)


```

# Experiment 1

Experiment 1 sought to examine whether the learnt attentional behaviour that develops during contextual cuing is expressed when participants are directed with an endogenous instructional cue to search in a particular region of the search space. Participants were first trained with a set of four repeating configurations in phase 1 across 5 epochs of 32 trials each. Then prior to phase 2, participants were told that an arrow would appear before every trial indicating the side of the screen on which the target would be located. This arrow was valid on every trial. In phase 2, the repeating configurations were presented in two forms: "consistent", where the target appeared in the same position as it has appeared for that configuration in phase 1; and "inconsistent", where the target appeared in a position in the opposite quadrant of the screen from where it had appeared in phase 1. Random configurations were also presented in this phase. If the contextual cues within the repeated configurations continue to guide attention in the presence of the instructional cue, then we would expect that response times would be faster on consistent trials compared to random trials. In addition, we would also expect that the contextual cues would guide attention *away* from the (new) target quadrant on inconsistent trials, and so response times should be slower on these trials compared to those on random trials. 

## Method

### Participants

```{r demographics_exp1}

# get basic stats for Ps

data_exp1 <- 
  data_raw %>% 
  filter(exp == "CCC01")

# rename TT variable
data_exp1 <- 
  data_exp1 %>% 
  mutate(TT = fct_recode(TT, 
                         "Repeated: consistent" = "repeated_con",
                         "Repeated: inconsistent" = "repeated_incon",
                         "Random: consistent" = "random_con",
                         "Random: inconsistent" = "random_incon")) %>% 
  mutate(TT = fct_relevel(TT, 
                          "Repeated: consistent", 
                          "Repeated: inconsistent",
                          "Random: consistent",
                          "Random: inconsistent"))

demographics <- 
  data_exp1 %>% 
  group_by(subj) %>% 
  slice(1) %>% 
  select(subj, age, gender)

```

`r Words(nrow(demographics))` undergraduate students from Lancaster University were recruited (mean age = `r mean(demographics$age)`, SD = `r sd(demographics$age)`; `r count(demographics[,2:3], gender)[1,2]` identified as male and `r count(demographics[,2:3], gender)[2,2]` as female) via the Psychology Research Participation System in the Department of Psychology at Lancaster University, in return for the opportunity to use the recruitment system for their own research in future years. 

### Materials
Participants were tested individually in a quiet room with a Dell laptop with a 15.6” screen, a screen resolution of 1920 x 1080, and a full size external keyboard for participants to use to respond to the task. Participants sat approximately 50 cm from the screen. Stimulus presentation was controlled by MATLAB using the Psychophysics Toolbox extensions (Brainard, 1997; Kleiner, Brainard & Pelli, 2007; Pelli, 1997). Responses to the target stimulus were made by pressing the ‘c’ or ‘n’ key on a standard keyboard. All experimental materials are available at the github repository for this study. 

Distractor stimuli were an ‘L’ shape (rotated 0°, 90°, 180°, or 270°) while the target stimulus was a ‘T’ shape (rotated at either 90° or 270°). Stimuli were XX mm (X.X°) square and arranged in a square grid of 144 evenly spaced cells (12 x 12) which was positioned centrally on the screen and was XXX mm (XX°) square. The grid itself was invisible to participants. The fixation cross (displayed centrally before each trial) was XX mm (X.X°) square. The background of the screen was grey (RGB: .6, .6, .6) and the stimuli were presented in black (RGB: 1, 1, 1). There was a small offset in the vertical line of the ‘L’ distractors, which increased the similarity between the ‘L’ distractors and the target ‘T’, making the search task more difficult (Duncan & Humphreys, 1989). 

### Design

Phase 1 employed a within-subjects design with factors of epoch (1-5) and configuration (repeated and random). All configurations contained 16 distractors, equally divided between the four quadrants of the display, and one target. Four repeated configurations were trained. Four target locations were used, with one from each quadrant assigned to each of the repeated configurations. These same four target positions were used for the the random configurations throughout the task. Each of these four target positions was chosen at random from one of five locations within each quadrant, that were approximately equidistant from the center of the screen. Distractors could not appear in these target locations. 

Phase 2 employed a within-subjects design with factors of epoch (6-10) and configuration (repeated: consistent; repeated: inconsistent; random: consistent; random:inconsistent). On each trial, there was a .5 probability that an "inconsistent" version of the configuration would be presented. This meant that the target was relocated to a diametrically opposed target position such as to maximise the displacement from the trained target position. This could occur for both the repeated and random configurations, hence creating four unqiue trial types for this phase. While random configurations did not have a "trained", associated, target position, it is necessary to divide the random trials into consistent and inconsistent trial types in this way in order to assess any target frequency effects that may occur, since the inconsistent target locations used in this phase were novel. 


### Procedure

Participants were tested individually in a quiet testing room. They were given instructions on how to complete the task, including the presentation of an example of a search trial. Participants were shown the two correct responses for the two possible orientations of targets. 

Each trial commenced with a fixation cross presented in the center of the screen for 500 ms, which was then replaced immediately by the search configuration. Participants searched for the target stimulus and responded with a left or right response depending on its orientation. Reaction times (RTs) were recorded from the onset of the search configuration. Following a valid response (c or n), the configuration was removed from the screen. The response–
stimulus interval (hereafter RSI) was 1,000 ms. If participants made an incorrect response to the target orientation, “ERROR!” appeared in the center of the screen for 3000 ms, prior to the RSI. 

Each block of eight trials contained each of the four different repeated configurations and four random configurations. These eight configurations could appear in any order with the constraint that the position of the target did not repeat across trials or across consecutive blocks.

A rest break of 30 seconds was given every 80 trials. Trials started automatically after
these breaks.

After 160 trials, prior to phase 2, particpiants were given an instruction screen which detailed the arrow that would appear on the screen prior to the configuration. They were able to ask any questions they had at this stage and then proceeded to phase 2. The arrow appeared for 1000ms between the removal of the fixation cross and the presentation of the search configuration. The task was otherwise identical to that used in phase 1. 

## Results


```{r exclusions_exp1}

# participant exclusions 

to_summary <- 
  data_exp1 %>% 
  group_by(subj) %>% 
  summarise(meanTO = mean(timeout)) %>% 
  mutate(z_meanTO = scale(meanTO)[,1])

acc_summary <- 
  data_exp1 %>% 
  group_by(subj) %>% 
  summarise(meanAcc = mean(acc, na.rm = TRUE)) %>% 
  mutate(z_meanAcc = scale(meanAcc)[,1])

rt_summary <- 
  data_exp1 %>% 
  filter(acc == 1) %>% 
  group_by(subj) %>% 
  summarise(meanRT = mean(RT, na.rm = TRUE)) %>% 
  mutate(z_meanRT = scale(meanRT)[,1])

# combine these into one dataframe
resp_summary_exp1 <- 
  to_summary %>% 
  left_join(acc_summary, by = "subj") %>% 
  left_join(rt_summary, by = "subj")

# is anyone an outlier in terms of timeouts?
outlier_to <- 
  resp_summary_exp1 %>% 
  filter(z_meanTO < -2.5 | z_meanTO > 2.5)

# is anyone an outlier in terms of accuracy?
outlier_acc <- 
  resp_summary_exp1 %>% 
  filter(z_meanAcc < -2.5 | z_meanAcc > 2.5)

# is anyone an outlier in terms of rt?
outlier_rt <- 
  resp_summary_exp1 %>% 
  filter(z_meanRT < -2.5 | z_meanRT > 2.5)

participants_removed <- 
  bind_rows(outlier_to, outlier_acc, outlier_rt) %>% 
  select(subj) %>% 
  mutate(subj = as.character(subj)) %>% 
  unique() %>% 
  pull()



```

Our criterion for removing outlier data, at both the participant level and the trial level, was 2.5 standard deviations above or below the mean of the sample. On average, trials ended with a timeout on `r spec_dec(100*mean(resp_summary_exp1$meanTO),2)`% of trials (SD = `r spec_dec(100*sd(resp_summary_exp1$meanTO),2)`). `r Words(nrow(outlier_to))` participants had an usually high proportion of timeouts and were removed from the analysis. The mean accuracy of participants (not including timeout trials) was `r spec_dec(100*mean(resp_summary_exp1$meanAcc),2)`% (SD = `r spec_dec(100*sd(resp_summary_exp1$meanAcc),2)`%). `r Words(nrow(outlier_acc))` participants that had an unusually low proportion of accurate trials and were also removed. The only participant deemed to be an outlier in terms of mean response time (hereafter RT) was also excluded on the basis of the timeout criterion, noted above. 

```{r rm_outliers_exp1}

# remove the participant outliers from the data
data_exp1_OR <- 
  data_exp1 %>% 
  filter(!subj %in% participants_removed)

# remove the timeouts and inaccurate trials
data_exp1_OR <- 
  data_exp1_OR %>% 
  filter(timeout == 0,
         acc == 1) %>% 
  group_by(subj) %>% 
  mutate(zRT = scale(RT)[,1]) # calculate z scores on participant basis

# get a summary of the RT outlier removal
rt_outlier_summary <- 
  data_exp1_OR %>% 
  group_by(subj) %>% 
  summarise(prop_rem = mean(zRT < -2.5 | zRT > 2.5))

# was anyone an outlier in prop removed?
outlier_prop_removed <- 
  rt_outlier_summary %>% 
  mutate(z_prop_rem = scale(prop_rem)[,1]) %>% 
  filter(z_prop_rem < -2.5 | z_prop_rem > 2.5)

# remove the outlier RTs from the data 
data_e1_f <-
  data_exp1_OR %>%
  ungroup() %>%
  filter(zRT > -2.5 & zRT < 2.5) # keep data in this range

```


For the remaining `r words(nrow(rt_outlier_summary))` participants we removed trials with a timeout and inaccurate trials, before removing outliers from the RT data. On average, the proportion of outliers removed was `r spec_dec(100*mean(rt_outlier_summary$prop_rem),2)`% (SD = `r spec_dec(100*sd(rt_outlier_summary$prop_rem),2)`%). `r words(nrow(outlier_prop_removed))` participants had an unusual proportion of trials removed as outlier RTs. 

```{r rt_summary_exp1}
# compute grand mean RT 
grand_mean_e1 <- mean(data_e1_f$RT)

# create subj level mean and normalised RT variable
data_e1_f <- 
  data_e1_f %>%
  group_by(subj) %>% 
  mutate(subj_mean_rt = mean(RT),
         normRT = RT - subj_mean_rt + grand_mean_e1) %>% 
  select(-subj_mean_rt)

# summarise the data across the 10 epochs, by subj
rt_summary_data_e1 <- 
  data_e1_f %>% 
  group_by(subj, epoch, TT) %>% 
  summarise(meanRT = mean(RT),
            mean_norm_RT = mean(normRT)) # used for normalised SE bars

# explore whether all Ps showed reduction in RTs phase 1 to phase 2 - yes they did
data_e1_f %>% 
  filter(epoch %in% c(4:7),
         acc == 1) %>% 
  group_by(subj, epoch) %>%
  summarise(meanRT = mean(RT)) %>% 
  pivot_wider(names_from = epoch, names_prefix = "epoch_", values_from = meanRT) %>% 
  rowwise() %>% 
  mutate(drop_in_RT = mean(c(epoch_4,epoch_5)) - mean(c(epoch_6,epoch_7))) %>% 
  view()

```


(ref:Exp1-RT-figure) RT data for Experiment 1

Within-subject error bars were computed by a process of normalising the RT data for the sample [@cousineau2005]. Figure \@ref(fig:Exp1-RT-figure) shows the RT data across the 10 epochs of the experiment. In phase 1 (epochs 1-5) a contextual cuing effect rapidly emerged. In phase 2, the presence of the guiding arrow had a dramatic effect on the reduction of response times. For all participants, the mean RT across epochs 4 and 5 was higher than the mean RTs across epochs 6 and 7.  Despite the clear evidence for the processing of the endogenous cue, the underlying search configuration continued to play a role in the guidance of attention, with faster response times for (consistent) repeated configurations compared to random configurations.  

```{r Exp1-RT-figure, fig.align="center", fig.cap="(ref:Exp1-RT-figure)", fig.dim=c(7,5), include = TRUE}

# summarise at the group level and plot
rt_summary_data_e1 %>% 
  group_by(epoch, TT) %>% 
  summarise(group_RT = mean(meanRT),
            group_SE = sd(mean_norm_RT)/sqrt(n())) %>% 
  ggplot(aes(x = epoch, y = group_RT, group = TT)) +
  geom_line(size = .5) +
  geom_errorbar(aes(ymin = group_RT - group_SE,
                    ymax = group_RT + group_SE),
                width = .2,
                size = .5) +
  geom_point(aes(fill = TT),size = 6, shape = 21) +
  labs(y = "RT (ms)",
       x = "Epochs of 32 trials") +
  scale_fill_manual(name = "", 
                    values = cbPalette,
                    labels = c("Repeated: consistent",
                               "Repeated: inconsistent",
                               "Random: consistent",
                               "Random: inconsistent")) +
  theme(legend.text = element_text(size = 10),
        legend.spacing.x = unit(0.4, "cm"),
        legend.position = c(0.5,.1),
        legend.direction = "horizontal") +
  guides(fill = guide_legend(byrow = TRUE)) +
  scale_y_continuous(limits = c(1000, 2400), breaks = seq(1000, 2400, 200))


```



```{r phase_1_BFs_exp1}
# Experiment 1 stats

# Statistics on Phase 1

phase_1 <- 
  rt_summary_data_e1 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(1:5))

#exp1_phase1_anova <- aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_1)

e1_phase1_BF <- 
  anovaBF(meanRT ~ TT * epoch + subj, 
          data = phase_1,
          whichRandom = "subj")

```

These data were explored with a Bayesian ANOVA, using the *BayesFactor::anovaBF()* function (for all analyses in this study the priors were set at the default "medium" width). First taking the data from phase 1 (epochs 1-5), the model with the largest Bayes Factor (BF) contained the factors of epoch and configuration (repeated vs. random), BF~10~ = `r changeSciNot(extractBF(e1_phase1_BF[3])$bf)`. The addition of the interaction term did not substantially improve the model fit, BF~10~ `r spec_dec(extractBF(e1_phase1_BF[4])$bf/extractBF(e1_phase1_BF[3])$bf,1)`.

```{r phase_2_BFs_exp1}
# Experiment 1 stats

# Statistics on Phase 2

phase_2 <- 
  rt_summary_data_e1 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(6:10))

#exp1_phase1_anova <- aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_1)

e1_phase2_BF <- 
  anovaBF(meanRT ~ TT * epoch + subj, 
          data = phase_2,
          whichRandom = "subj")

# explore the main effect of configuration
phase_2_pairwise <- 
  data_e1_f %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(6:10)) %>%  
  group_by(subj, TT) %>% 
  summarise(meanRT = mean(RT))

# consistent vs. random
CvR <- 
  phase_2_pairwise %>% 
  filter(TT %in% c("Repeated: consistent", "Random: consistent")) 

CvR_BF <- 
  anovaBF(meanRT ~ TT + subj, 
          data = CvR,
          whichRandom = "subj")

# inconsistent vs. random
IvR <- 
  phase_2_pairwise %>% 
  filter(TT %in% c("Repeated: inconsistent", "Random: inconsistent")) 

IvR_BF <-
  anovaBF(meanRT ~ TT + subj, 
          data = IvR,
          whichRandom = "subj")

# consistent vs. inconsistent 
CvI <- 
  phase_2_pairwise %>% 
  filter(TT %in% c("Repeated: consistent", "Repeated: inconsistent")) 

CvI_BF <-
  anovaBF(meanRT ~ TT + subj, 
          data = CvI,
          whichRandom = "subj")

```

A Bayesian ANOVA on the data from phase 2 (epochs 6-10) found significant support for the model containing the factor of configuration, BF~10~ = `r changeSciNot(extractBF(e1_phase2_BF[2])$bf)`. There was evidence to suggest that the addition of the factor of epoch did not substantially improve the model predictions, BF~10~ `r spec_dec(extractBF(e1_phase2_BF[3])$bf/extractBF(e1_phase2_BF[2])$bf,1)`. Comparing the response times from just "repeated: consistent" trials with their respective random trials (random: consistent), revealed support for a difference between these trial types, BF~10~ =  `r as.data.frame(CvR_BF)[1,1]`. There was no evidence to support a difference between the "repeated: inconsistent" trials and the respective random trials, BF~10~ =  `r as.data.frame(IvR_BF)[1,1]`. There was substantial support for a difference between the repeated consistent and the repeated inconsistent trials, BF~10~ =  `r as.data.frame(CvI_BF)[1,1]`.


```{r trad_ANOVA_phase_2_exp1}
# Statistics on Stage 2

phase_2 <- 
  rt_summary_data_e1 %>% 
  mutate(epoch = as.numeric(epoch)) %>% 
  filter(epoch > 5)

aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_2)

# random vs consistent
RvC <- 
  phase_2 %>% 
  filter(TT %in% c("Random: consistent", "Repeated: consistent"))

t.test(meanRT ~ TT, data = RvC)

# random vs. inconsistent
RvI <- 
  phase_2 %>% 
  filter(TT %in% c("Random: inconsistent", "Repeated: inconsistent"))

t.test(meanRT ~ TT, data = RvI)

# consistent vs. inconsistent
CvI <- 
  phase_2 %>% 
  filter(TT %in% c("Repeated: consistent", "Repeated: inconsistent"))

t.test(meanRT ~ TT, data = CvI)

```

## Discussion

Experiment 1 sought to examine the consequence of an endogenous cue that prompts top-down control of the search process on contextual cuing. In phase 1 we established a robust contextual cuing effect. Following this, participants received instruction that each trial would be preceded by an arrow stimulus that would signal the side of the screen on which the target would appear. This cue was valid on all trials in phase 2. Consistent with these instructions and the processing of this cue, we observed substantially reduced search times in phase 2 compared to phase 1. The same set of repeated configurations were presented in Phase 2, but for half of the trials, the target was relocated to the diagonally opposed quadrant of the screen. Therefore, on these "repeated inconsistent" trials, the underlying configuration of distractors predicted the target in a location that opposed that of the (valid) endogenous cue. Across this phase we observed significant contextual cuing for the repeated consistent trials, demonstrating that the underlying configuration of distractors continues to guide attention in the presence of the endogenous cue. However, the repeated inconsistent trials did not lead to an impairment in response times relative to random trials, suggesting that the underlying configuration did not influence search on these trials. 

# Experiment 2

In Experiment 1 we demonstrated that an established effect of contextual cuing is maintained even when attention is being guided by the presence of a valid endogenous cue. That is, we examined whether the *performance* component of contextual cuing is disrupted by a concurrent controlled attentional behaviour. In Experiment 2 we wanted to explore the *learning* of the contextual cue itself, examining whether the presence of a valid endogenous cue may limit the development of a contextual cuing effect. To do this, we trained each participant on two sets of repeating configurations. One of these sets was always presented in the presence of a valid endognenous cue, while the other set was always presented in the absence of the endogenous cue. The extent to which there is a "cue-competition" effect between the endogneous and the contextual cue can be examined by comparing the contextual cuing effect we observe for the two sets of configurations. Given the (expected) difference in RTs we observed in Experiment 1, between the trials with the endogenous cue present and the cue being absent, in a second phase we removed the endogenous cue entirely from the task. This second phase therefore allows us to directly compare the conextual cuing for the two sets of participants when RTs are of the same magnitude overall.

"Cue-competition" effects have been examined previously in contextual cuing.  @endo2004 trained participants with a contextual cuing task composed of distractor location configurations and repeating distractor identities. Their experiments suggested that the stronger configural (spatial) cue out-competed the cue provided by the distractor identities. Similarly, @kunar2014 found that when colour cues and configural cues both predicted the target location, configural cues were dominant and tended to overshadow the weaker colour cue. @beesley2012 looked at the cue-interaction effects *within* a configuration of distractors. Participants were first trained with half a configuration of repeating distractors that predicted the target (8 out of 16 distractors). In a later stage these distractors were paired with a new half-configuration, such that the whole configuration now predicted the same target location. In contrast to the predictions of the vast majority of models of contingency learning, learning about these new predictive distractors was facilitated, rather than impaired in this second phase (relative to a control condition). Thus, @beesley2012 found that cue-competition was not observed within a configuration of equally predictive distractors. Together these studies suggest that the repeated configuration will out-compete non-configural cues for access to the learning mechanism. The dominance of the configuration in these situations may therefore lead to the prediction that the endogenous cue would not "block" the learning of the configuration in this task. 

## Method

### Participants

```{r demographics_exp2}

# get basic stats for Ps

data_exp2 <- 
  data_raw %>% 
  filter(exp == "CCC02") 

demographics <- 
  data_exp1 %>% 
  group_by(subj) %>% 
  slice(1) %>% 
  select(subj, age, gender)

```

`r Words(nrow(demographics))` undergraduate students from Lancaster University were recruited (mean age = `r mean(demographics$age)`, SD = `r sd(demographics$age)`; `r count(demographics[,2:3], gender)[1,2]` identified as male and `r count(demographics[,2:3], gender)[2,2]` as female) via the Psychology Research Participation System in the Department of Psychology at Lancaster University, in return for the opportunity to use the recruitment system for their own research in future years. 

### Materials
The materials and stimuli were identical to Experiment 1.

### Design



### Procedure

## Results


```{r exclusions_exp2}

# participant exclusions 

to_summary <- 
  data_exp2 %>% 
  group_by(subj) %>% 
  summarise(meanTO = mean(timeout)) %>% 
  mutate(z_meanTO = scale(meanTO)[,1])

acc_summary <- 
  data_exp2 %>% 
  group_by(subj) %>% 
  summarise(meanAcc = mean(acc, na.rm = TRUE)) %>% 
  mutate(z_meanAcc = scale(meanAcc)[,1])

rt_summary <- 
  data_exp2 %>% 
  filter(acc == 1) %>% 
  group_by(subj) %>% 
  summarise(meanRT = mean(RT, na.rm = TRUE)) %>% 
  mutate(z_meanRT = scale(meanRT)[,1])

resp_summary_exp2 <- 
  to_summary %>% 
  left_join(acc_summary, by = "subj") %>% 
  left_join(rt_summary, by = "subj")

# is anyone an outlier in terms of timeouts?
outlier_to <- 
  resp_summary_exp2 %>% 
  filter(z_meanTO < -2.5 | z_meanTO > 2.5)

# is anyone an outlier in terms of accuracy?
outlier_acc <- 
  resp_summary_exp2 %>% 
  filter(z_meanAcc < -2.5 | z_meanAcc > 2.5)

# is anyone an outlier in terms of rt?
outlier_rt <- 
  resp_summary_exp2 %>% 
  filter(z_meanRT < -2.5 | z_meanRT > 2.5)

participants_removed <- 
  bind_rows(outlier_to, outlier_acc, outlier_rt) %>% 
  select(subj) %>% 
  mutate(subj = as.character(subj)) %>% 
  unique() %>% 
  pull()

```

Our criteria for removing outlier data were identical to Experiment 1. On average, trials ended with a timeout on `r spec_dec(100*mean(resp_summary_exp2$meanTO),2)`% of trials (SD = `r spec_dec(100*sd(resp_summary_exp2$meanTO),2)`). `r Words(nrow(outlier_to))` participants had an usually high proportion of timeouts. The mean accuracy of participants (not including timeout trials) was `r spec_dec(100*mean(resp_summary_exp2$meanAcc),2)`% (SD = `r spec_dec(100*sd(resp_summary_exp2$meanAcc),2)`%). `r Words(nrow(outlier_acc))` participants that had an unusually low proportion of accurate trials and were also removed. `r Words(nrow(outlier_rt))` participants were deemed to be an outlier in terms of mean RT. 

```{r rm_outliers_exp2}

data_exp2_OR <- 
  data_exp2 %>% 
  filter(!subj %in% participants_removed)

data_exp2_OR <- 
  data_exp2_OR %>% 
  filter(timeout == 0,
         acc == 1) %>% 
  group_by(subj) %>% 
  mutate(zRT = scale(RT)[,1]) # calculate z scores on participant basis

rt_outlier_summary <- 
  data_exp2_OR %>% 
  group_by(subj) %>% 
  summarise(prop_rem = mean(zRT < -2.5 | zRT > 2.5))

# was anyone an outlier in prop removed?
outlier_prop_removed <- 
  rt_outlier_summary %>% 
  mutate(z_prop_rem = scale(prop_rem)[,1]) %>% 
  filter(z_prop_rem < -2.5 | z_prop_rem > 2.5)

data_e2_f <-
  data_exp2_OR %>%
  ungroup() %>%
  filter(zRT > -2.5 & zRT < 2.5) # keep data in this range

```


For the remaining `r words(nrow(rt_outlier_summary))` participants we removed trials with a timeout and inaccurate trials, before removing outliers from the RT data. On average, the proportion of outliers removed was `r spec_dec(100*mean(rt_outlier_summary$prop_rem),2)`% (SD = `r spec_dec(100*sd(rt_outlier_summary$prop_rem),2)`%). `r words(nrow(outlier_prop_removed))` participants had an unusual proportion of trials removed as outlier RTs and were not included in the final analysis. 

```{r Exp2-RT-figure, fig.align="center", fig.cap="(ref:Exp2-RT-figure)", fig.dim=c(6,6), include = TRUE}

factorCols <- c("subj","TT","patType", "patArrowP1", "tQuad")
data_e2_f[factorCols] <- lapply(data_e2_f[factorCols], factor)
data_e2_f$TT <- recode_factor(data_e2_f$TT, "1" = "repeated", "2" = "random")
data_e2_f$patArrowP1 <- recode_factor(data_e2_f$patArrowP1, "1" = "arrow", "2" = "no arrow")

factorLbls <- c("Repeated: Arrow", "Random: Arrow", "Repeated: No arrow", "Random: No arrow")

# summarise the data across the 10 epochs, by subj
rt_summary_data_e2 <- 
  data_e2_f %>% 
  group_by(subj, patArrowP1, epoch, TT) %>% 
  summarise(meanRT = mean(RT))



# summarise at the group level and plot
rt_summary_data_e2 %>% 
  group_by(epoch, patArrowP1, TT) %>% 
  summarise(group_RT = mean(meanRT),
            group_SE = sd(meanRT)/sqrt(n())) %>% 
  ggplot(aes(x = epoch, y = group_RT, group = interaction(TT, patArrowP1))) +
  geom_line()+
  geom_errorbar(aes(ymin = group_RT - group_SE,
                    ymax = group_RT + group_SE),
                width = .2) +
  geom_point(aes(fill = interaction(TT, patArrowP1),
                 shape = interaction(TT, patArrowP1)), size = 6) +
  scale_fill_manual(name = "",
                    labels = factorLbls,
                    values= c(cbPalette[c(1,3)],c(cbPalette[c(1,3)]))) +
  scale_shape_manual(name = "",
                     labels = factorLbls,
                     values = c(21,21,22,22)) +
  labs(y = "RT (ms)",
       x = "Epochs of 32 trials") +
  theme(legend.text = element_text(size = 10),
        legend.spacing.x = unit(0.4, "cm"),
        legend.position = c(0.5,.1),
        legend.direction = "horizontal") +
  guides(fill = guide_legend(byrow = TRUE)) +
  scale_y_continuous(limits = c(1000, 2800), breaks = seq(1000, 2800, 200)) 


  # geom_line()+
  # geom_point(aes(fill = interaction(TT, patArrowP1), shape = interaction(TT, patArrowP1)), size = 3) +
  # scale_fill_manual(name = "",
  #                   labels = factorLbls,
  #                   values=c("black", "black", "white", "white")) +
  # scale_shape_manual(name = "",
  #                    labels = factorLbls,
  #                    values = c(21,22,21,22))+
  # scale_x_continuous(limits = c(1,10), breaks = 1:10)

```

```{r phase_1_BFs_exp2}
# Statistics on Stage 1

phase_1 <- 
  rt_summary_data_e2 %>% 
  mutate(epoch = as.numeric(epoch)) %>% 
  filter(epoch <= 5)

aov_car(meanRT ~ Error(subj/patArrowP1*TT*epoch), data = phase_1)

# no evidence for an interaction of arrow training and TT
# is there evidence for the null?
phase_1_BF <- 
  anovaBF(meanRT ~ patArrowP1*TT + subj,
          data= data.frame(phase_1),
          whichRandom = "subj")

phase_1_BF[4]/phase_1_BF[3]
# the evidence favours an absence of an interaction effect

```

```{r phase_2_BFs_exp2}
# Statistics on Stage 2

phase_2 <- 
  rt_summary_data_e2 %>% 
  mutate(epoch = as.numeric(epoch)) %>% 
  filter(epoch > 5)

aov_car(meanRT ~ Error(subj/patArrowP1*TT*epoch), data = phase_2)

# no evidence for an interaction of arrow training and TT
# is there evidence for the null?
phase_2_BF <- 
  anovaBF(meanRT ~ patArrowP1*TT + subj,
          data= data.frame(phase_2),
          whichRandom = "subj")

phase_2_BF[4]/phase_2_BF[3]
# the evidence favours an absence of an interaction effect


```

# Experiment 3

Experiment 3 sought to examine ...

## Method

### Participants

```{r}

# get basic stats for Ps

data_exp3 <- 
  data_raw %>% 
  filter(exp == "CCC03") 

# rename TT variable
data_exp3 <- 
  data_exp3 %>% 
  mutate(TT = fct_recode(TT, 
                         "Repeated GLOBAL" = "global (local random)",
                         "Repeated LOCAL" = "local (global random)",
                         "Random" = "random",
                         "Repeated" = "repeated")) %>% 
  mutate(TT = fct_relevel(TT, 
                          "Repeated", 
                          "Random", 
                          "Repeated GLOBAL", 
                          "Repeated LOCAL"))

demographics <- 
  data_exp3 %>% 
  group_by(subj) %>% 
  slice(1) %>% 
  select(subj, age, gender)

```

`r Words(nrow(demographics))` undergraduate students from Lancaster University were recruited (mean age = `r mean(demographics$age)`, SD = `r sd(demographics$age)`; `r count(demographics[,2:3], gender)[1,2]` identified as male and `r count(demographics[,2:3], gender)[2,2]` as female) via the Psychology Research Participation System in the Department of Psychology at Lancaster University, in return for the opportunity to use the recruitment system for their own research in future years. 

### Materials
The materials and stimuli were identical to Experiment 1.

### Design


### Procedure

## Results


```{r}

# participant exclusions 

to_summary <- 
  data_exp3 %>% 
  group_by(subj) %>% 
  summarise(meanTO = mean(timeout)) %>% 
  mutate(z_meanTO = scale(meanTO)[,1])

acc_summary <- 
  data_exp3 %>% 
  group_by(subj) %>% 
  summarise(meanAcc = mean(acc, na.rm = TRUE)) %>% 
  mutate(z_meanAcc = scale(meanAcc)[,1])

rt_summary <- 
  data_exp3 %>% 
  filter(acc == 1) %>% 
  group_by(subj) %>% 
  summarise(meanRT = mean(RT, na.rm = TRUE)) %>% 
  mutate(z_meanRT = scale(meanRT)[,1])

resp_summary_exp3 <- 
  to_summary %>% 
  left_join(acc_summary, by = "subj") %>% 
  left_join(rt_summary, by = "subj")

# is anyone an outlier in terms of timeouts?
outlier_to <- 
  resp_summary_exp3 %>% 
  filter(z_meanTO < -2.5 | z_meanTO > 2.5)

# is anyone an outlier in terms of accuracy?
outlier_acc <- 
  resp_summary_exp3 %>% 
  filter(z_meanAcc < -2.5 | z_meanAcc > 2.5)

# is anyone an outlier in terms of rt?
outlier_rt <- 
  resp_summary_exp3 %>% 
  filter(z_meanRT < -2.5 | z_meanRT > 2.5)

participants_removed <- 
  bind_rows(outlier_to, outlier_acc, outlier_rt) %>% 
  select(subj) %>% 
  mutate(subj = as.character(subj)) %>% 
  unique() %>% 
  pull()

```

Our criteria for removing outlier data were identical to Experiment 1. On average, trials ended with a timeout on `r spec_dec(100*mean(resp_summary_exp3$meanTO),2)`% of trials (SD = `r spec_dec(100*sd(resp_summary_exp3$meanTO),2)`). `r Words(nrow(outlier_to))` participants had an usually high proportion of timeouts. The mean accuracy of participants (not including timeout trials) was `r spec_dec(100*mean(resp_summary_exp3$meanAcc),2)`% (SD = `r spec_dec(100*sd(resp_summary_exp3$meanAcc),2)`%). `r Words(nrow(outlier_acc))` participants that had an unusually low proportion of accurate trials and were also removed. `r Words(nrow(outlier_rt))` participants were deemed to be an outlier in terms of mean RT. 

```{r}

data_exp3_OR <- 
  data_exp3 %>% 
  filter(!subj %in% participants_removed)

data_exp3_OR <- 
  data_exp3_OR %>% 
  filter(timeout == 0,
         acc == 1) %>% 
  group_by(subj) %>% 
  mutate(zRT = scale(RT)[,1]) # calculate z scores on participant basis

rt_outlier_summary <- 
  data_exp3_OR %>% 
  group_by(subj) %>% 
  summarise(prop_rem = mean(zRT < -2.5 | zRT > 2.5))

# was anyone an outlier in prop removed?
outlier_prop_removed <- 
  rt_outlier_summary %>% 
  mutate(z_prop_rem = scale(prop_rem)[,1]) %>% 
  filter(z_prop_rem < -2.5 | z_prop_rem > 2.5)

data_e3_f <-
  data_exp3_OR %>%
  ungroup() %>%
  filter(zRT > -2.5 & zRT < 2.5) # keep data in this range

```


For the remaining `r words(nrow(rt_outlier_summary))` participants we removed trials with a timeout and inaccurate trials, before removing outliers from the RT data. On average, the proportion of outliers removed was `r spec_dec(100*mean(rt_outlier_summary$prop_rem),2)`% (SD = `r spec_dec(100*sd(rt_outlier_summary$prop_rem),2)`%). `r words(nrow(outlier_prop_removed))` participants had an unusual proportion of trials removed as outlier RTs and were not included in the final analysis [EAF4S]. 


```{r Exp3-RT-figure, fig.align="center", fig.cap="(ref:Exp3-RT-figure)", fig.dim=c(7,5), include=TRUE}

# summarise the data across the 10 epochs, by subj
rt_summary_data_e3 <-
  data_e3_f %>%
  group_by(subj, epoch, TT) %>%
  summarise(meanRT = mean(RT))

# summarise at the group level and plot
rt_summary_data_e3 %>%
  group_by(epoch, TT) %>%
  summarise(group_RT = mean(meanRT),
            group_SE = sd(meanRT)/sqrt(n())) %>%
  ggplot(aes(x = epoch, y = group_RT, group = TT, fill = TT)) +
  geom_line(size = .5) +
  geom_errorbar(aes(ymin = group_RT - group_SE,
                    ymax = group_RT + group_SE),
                width = .05) +
    geom_point(aes(fill = TT),size = 6, shape = 21) +
  labs(y = "RT (ms)",
       x = "Epochs of 32 trials") +
  scale_fill_manual(name = "",
                    values = cbPalette[c(1,3,2,4)]) +
  theme(legend.text = element_text(size = 10),
        legend.spacing.x = unit(0.4, "cm"),
        legend.position = c(0.5,0.1),
        legend.direction = "horizontal") +
  guides(fill = guide_legend(byrow = TRUE)) +
  scale_y_continuous(limits = c(1000, 2600), breaks = seq(1000, 2600, 200))


```

```{r}
# Statistics on Stage 1

phase_1 <- 
  rt_summary_data_e3 %>% 
  mutate(epoch = as.numeric(epoch)) %>% 
  filter(epoch <= 5)

aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_1)

anovaBF(meanRT ~ TT + subj,
        whichRandom = "subj",
        data = phase_1)

```

```{r}
# Statistics on Stage 2

phase_2 <- 
  rt_summary_data_e3 %>% 
  mutate(epoch = as.numeric(epoch)) %>% 
  filter(epoch > 5)

aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_2)

# Bayesian analysis of phase 2

anovaBF(meanRT ~ TT + subj,
        whichRandom = "subj",
        data = phase_2)

# repeated vs local random
d1v3 <- 
  phase_2 %>% 
  filter(TT %in% c("Repeated",
                   "Repeated LOCAL"))

anovaBF(meanRT ~ TT + subj,
        whichRandom = "subj",
        data = d1v3)

# repeated vs global random
d1v4 <- 
  phase_2 %>% 
  filter(TT %in% c("Repeated",
                   "Repeated GLOBAL"))

anovaBF(meanRT ~ TT + subj,
        whichRandom = "subj",
        data = d1v4)

# local vs. random
d2v3 <- 
  phase_2 %>% 
  filter(TT %in% c("Random",
                   "Repeated LOCAL"))

anovaBF(meanRT ~ TT + subj,
        whichRandom = "subj",
        data = d2v3)

# global vs. random
d2v4 <- 
  phase_2 %>% 
  filter(TT %in% c("Random",
                   "Repeated GLOBAL"))

anovaBF(meanRT ~ TT + subj,
        whichRandom = "subj",
        data = d2v4)

# local  vs. global  
d3v4 <- 
  phase_2 %>% 
  filter(TT %in% c("Repeated LOCAL",
                   "Repeated GLOBAL"))

anovaBF(meanRT ~ TT + subj,
        whichRandom = "subj",
        data = d3v4)

t.test(meanRT ~ TT,
        data = d3v4,
       paired = TRUE)

```




\newpage

# References
